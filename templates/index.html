<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Exame de Consciência - Pecados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
    <div class="container">
        <h1>Exame de Consciência - Selecione seus pecados</h1>

        <form method="POST" action="/">
            {% for mandamento, lista in pecados.items() %}
                <fieldset>
                    <legend>{{ mandamento }}</legend>
                    {% for i, pecado in enumerate(lista) %}
                        <label class="pecado-item">
                            <input type="checkbox" name="{{ mandamento }}" value="{{ i }}" />
                            {{ pecado }}
                        </label>
                    {% endfor %}
                </fieldset>
            {% endfor %}

            <fieldset>
                <legend>Outros pecados (escreva aqui):</legend>
                <textarea name="custom" placeholder="Digite aqui outros pecados..." rows="4"></textarea>
            </fieldset>

            <button type="submit" class="btn">Gerar Resultado</button>
        </form>

        {% if resultado %}
        <hr />
        <h2>Resultado dos pecados selecionados:</h2>
        <div id="resultado-html">
            <form method="POST" action="/download" id="form-download">
                <pre style="white-space: pre-wrap;">
{% for mandamento, pecados_sel in resultado.items() %}
<strong>{{ mandamento }}:</strong>
{% for p in pecados_sel %}
- {{ p }}
{% endfor %}
{% endfor %}
                </pre>
                <input type="hidden" name="html_conteudo" id="html_conteudo" />
                <button type="submit" class="btn">Baixar PDF</button>
            </form>
        </div>
        {% endif %}
    </div>

    <script>
        // Preenche o input hidden com o conteúdo do resultado para enviar no PDF
        const formDownload = document.getElementById('form-download');
        if(formDownload){
            formDownload.addEventListener('submit', function(e){
                const resultadoDiv = document.getElementById('resultado-html');
                document.getElementById('html_conteudo').value = resultadoDiv.innerHTML;
            });
        }
    </script>
</body>
</html>
