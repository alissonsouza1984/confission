<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ðŸ§¾ Exame de ConsciÃªncia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Estilos Bootstrap CDN (Render suporta sem problemas) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            padding: 2rem;
        }
        textarea {
            resize: vertical;
        }
    </style>
</head>
<body class="container">
    <h1 class="mb-4 text-center">ðŸ§¾ Exame de ConsciÃªncia</h1>

    <form method="POST">
        {% for mandamento, lista in pecados.items() %}
            <div class="mb-4">
                <h5 class="text-primary">{{ mandamento }}</h5>
                {% for pecado in lista %}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="{{ mandamento }}" value="{{ loop.index0 }}" id="{{ mandamento }}-{{ loop.index0 }}">
                        <label class="form-check-label" for="{{ mandamento }}-{{ loop.index0 }}">{{ pecado }}</label>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}

        <div class="mb-4">
            <label for="custom" class="form-label fw-bold">Outros pecados (personalizados):</label>
            <textarea class="form-control" id="custom" name="custom" rows="3" placeholder="Digite aqui..."></textarea>
        </div>

        <div class="d-flex flex-column flex-md-row gap-3">
            <button type="submit" class="btn btn-success">Gerar PDF</button>
            <a href="/" class="btn btn-secondary">Limpar seleÃ§Ã£o</a>
        </div>
    </form>

    {% if resultado %}
        <hr class="my-5">
        <h3 class="text-success">ðŸ“‹ Pecados selecionados</h3>
        <form action="{{ url_for('download') }}" method="POST">
            <div id="conteudo" class="mb-3">
                {% for mandamento, pecados_selecionados in resultado.items() %}
                    <h5 class="mt-4">{{ mandamento }}</h5>
                    <ul>
                        {% for p in pecados_selecionados %}
                            <li>{{ p }}</li>
                        {% endfor %}
                    </ul>
                {% endfor %}
            </div>

            <!-- Envia conteÃºdo HTML para o PDF -->
            <input type="hidden" name="html_conteudo" id="html_conteudo">
            <button type="submit" class="btn btn-primary mt-3">ðŸ“¥ Baixar PDF</button>
        </form>

        <script>
            // Preenche o campo oculto com o HTML visÃ­vel
            document.querySelector("form[action='{{ url_for('download') }}']").addEventListener("submit", function () {
                document.getElementById("html_conteudo").value = document.getElementById("conteudo").innerHTML;
            });
        </script>
    {% endif %}
</body>
</html>
